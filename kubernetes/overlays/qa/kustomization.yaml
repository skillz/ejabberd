namespace: server
bases:
- ../../base
resources:
- external-tf-map.yaml # Generated by terraform and downloaded in Makefile
- service-internal-administration.yaml
configMapGenerator:
- name: ejabberd-config
  behavior: merge
  files:
  - config/hosts.yaml
  - config/access-control-lists.yaml
  - config/authentication.yaml
- name: chat-service-config
  behavior: merge
  literals:
  - service_name_admin=chat-service-admin
patchesStrategicMerge:
- statefulset.yaml
- service-external.yaml
vars:
- name: SVC_NAME_ADMIN
  objref:
    kind: ConfigMap
    name: chat-service-config
    apiVersion: v1
  fieldref:
    fieldpath: data.service_name_admin
- name: PUBLIC_DNS_ZONE_NAME
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.public_dns_zone_name
- name: PRIVATE_DNS_ZONE_NAME
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.private_dns_zone_name
- name: PRIVATE_ELB_SG
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.private_lb_security_group_id
- name: PUBLIC_ELB_SG
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.public_lb_security_group_id
- name: RDS_DB_ENDPOINT
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.rds_endpoint
- name: ECR_REPOSITORY
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.ecr_repository
- name: IAM_ROLE
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.iam_role