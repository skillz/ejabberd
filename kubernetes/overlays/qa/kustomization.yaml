namespace: server
bases:
- ../../base
resources:
- external-tf-map.yaml # Generated by terraform and downloaded in Makefile
configMapGenerator:
- name: ejabberd-config
  behavior: merge
  files:
  - config/hosts.yaml
  - config/access-control-lists.yaml
  - config/authentication.yaml
- name: chat-service-config
  behavior: merge
  literals:
  - docker_registry=058716573031.dkr.ecr.us-west-2.amazonaws.com # Requires cluster authentication with ECR
vars:
- name: PUBLIC_DNS_ZONE_NAME
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.public_dns_zone_name
- name: PRIVATE_DNS_ZONE_NAME
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.private_dns_zone_name
- name: PRIVATE_ELB_SG
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.private_lb_security_group_id
- name: PUBLIC_ELB_SG
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.public_lb_security_group_id
- name: RDS_DB_ENDPOINT
  objref:
    apiVersion: v1
    kind: ConfigMap
    name: tf-ejabberd-external
  fieldref:
    fieldpath: data.rds_endpoint
